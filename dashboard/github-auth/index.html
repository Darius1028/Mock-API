<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Mock API Dashboard</title>
    
    <link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css">

    <!-- Sweetalert2 Default Theme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-default@5.0.8/default.min.css" integrity="sha256-v43W/NzPbaavipHsTh1jdc2zWJ1YSTzJlBajaQBPSlw=" crossorigin="anonymous">

    <link rel="stylesheet" href="../css/main.css">

    <style>
        .repo-list-item {
            cursor: pointer;
            transition: .1s;
        }
        .repo-list-item:hover {
            background-color: #eceeec;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-3 m-4">
        <div class="row p-5 rounded-corners bg-dark text-light">
            <div class="col">
                <h1>Mock API Dashboard Github Integration</h1>
                <p>
                    Connect the Mock API Dashboard with your Github account using a personal access token.
                </p>
            </div>
        </div>

        <div class="row mt-3 p-5 rounded-corners shadow">
            <div class="col">
                <a class="btn btn-light mb-4" href="../" id="back-btn"><i class="bi bi-caret-left-fill"></i> Back</a>

                <div id="page-1">
                    <p>Personal access tokens can be created <a href="https://github.com/settings/tokens/new" target="_blank">here</a>.</p>
                    <p>
                        The personal access token that you generate should have access to the <i>repo</i> scope.
                    </p>
                    <p>
                        Please enter your Github  personal access token below, the information that you enter here will be stored in your cookies for 60 days in your browser. It is recommended that you regularly update your personal access token for security reasons.
                    </p>

                    <div class="form-group mt-4 mb-3">
                        <label for="github-token-input">Personal Access Token</label>
                        <input type="text" class="form-control mt-2" placeholder="A long string of numbers and letters" autocomplete="off" id="github-token-input">
                    </div>

                    <button class="btn btn-primary" onclick="initialConnect()"><i class="bi bi-github"></i> Connect to Github</button>
                </div>  

                <div id="page-2" style="display:none">
                    <h3>Please select a repository</h3>
                    <p>
                        Please select the repository that this instance of the Mock API dashboard is running on.
                    </p>

                    <div class="d-flex justify-content-between-align-items-start">
                        <div>
                            <input type="text" class="form-control mb-1" placeholder="Search..." onkeyup="searchRepoList(this)" id="repo-list-search-input">
                            <ul class="list-group mb-2" id="repo-list"></ul>
                        </div>

                    </div>
                </div>

            </div>
        </div>

        <div class="row mt-5 pt-3">
            <div class="col">
                <code>
                    By Jack Childs 2022
                </code><br>
                <code>
                    MIT License
                </code>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.2.1/dist/sweetalert2.min.js" integrity="sha256-OVxeY1nP2DXp15LcHll2UDTcwaqvHlJ3xj1CjVLqvsY=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js" integrity="sha256-0H3Nuz3aug3afVbUlsu12Puxva3CP4EhJtPExqs54Vg=" crossorigin="anonymous"></script>

    <script type="module" src="../js/imports.mjs"></script>
   
    <script src="js/github-integration.js"></script>

    <script>
        function searchRepoList(input) {
            var filter = input.value.toUpperCase();
            var ul = input.parentNode.parentNode.getElementsByTagName('ul')[0];
            var li = ul.getElementsByTagName('li');

            let displayed = 10;
            for (var i = 0; i < li.length; i++) {
                if (li[i].getAttribute('data-repo-name').toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = 'block';
                    displayed++;
                } else {
                    li[i].style.display = 'none';
                    displayed--;
                }
            }
        }
    </script>

</body>
</html>